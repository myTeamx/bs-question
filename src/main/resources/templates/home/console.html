<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>问卷管理系统</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="../../static/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../../static/layuiadmin/style/admin.css" media="all">
</head>
<body>

<div class="layui-fluid">
    <div class="layui-row layui-col-space15">

        <div class="layui-col-sm6 layui-col-md3">
            <div class="layui-card">
                <div class="layui-card-header">
                    访问量
                    <span class="layui-badge layui-bg-blue layuiadmin-badge">月</span>
                </div>
                <div class="layui-card-body layuiadmin-card-list">
                    <p class="layuiadmin-big-font" id="visit_month">0</p>
                    <p>
                        总计访问量
                        <span class="layuiadmin-span-color"><span id="visit_all">0</span> <i
                                class="layui-inline layui-icon layui-icon-flag"></i></span>
                    </p>
                </div>
            </div>
        </div>
        <div class="layui-col-sm6 layui-col-md3">
            <div class="layui-card">
                <div class="layui-card-header">
                    用户量
                    <span class="layui-badge layui-bg-cyan layuiadmin-badge">月</span>
                </div>
                <div class="layui-card-body layuiadmin-card-list">
                    <p class="layuiadmin-big-font" id="usercount_month">0</p>
                    <p>
                        总用户量
                        <span class="layuiadmin-span-color"><span id="usercount_all">0</span> <i
                                class="layui-inline layui-icon layui-icon-face-smile-b"></i></span>
                    </p>
                </div>
            </div>
        </div>
        <div class="layui-col-sm6 layui-col-md3">
            <div class="layui-card">
                <div class="layui-card-header">
                    活跃用户
                    <span class="layui-badge layui-bg-orange layuiadmin-badge">月</span>
                </div>
                <div class="layui-card-body layuiadmin-card-list">

                    <p class="layuiadmin-big-font" id="useractive_month">0</p>
                    <p>
                        最近一个月
                        <span class="layuiadmin-span-color"><span id="useractive_month_percentage">0%</span> <i
                                class="layui-inline layui-icon layui-icon-user"></i></span>
                    </p>
                </div>
            </div>
        </div>
        <div class="layui-col-sm6 layui-col-md3">
            <div class="layui-card">
                <div class="layui-card-header">
                    问卷量
                    <span class="layui-badge layui-bg-green layuiadmin-badge">月</span>
                </div>
                <div class="layui-card-body layuiadmin-card-list">

                    <p class="layuiadmin-big-font" id="questioncount_month">0</p>
                    <p>
                        总问卷量
                        <span class="layuiadmin-span-color"><span id="question_count_all">0</span> <i
                                class="layui-inline layui-icon layui-icon-file-b"></i></span>
                    </p>
                </div>
            </div>
        </div>
        <div class="layui-col-sm12">
            <div class="layui-card">
                <div class="layui-card-header">
                    访问量
                    <div class="layui-btn-group layuiadmin-btn-group">
                        <a href="javascript:;" class="layui-btn layui-btn-primary layui-btn-xs">今年</a>
                    </div>
                </div>
                <div class="layui-card-body">
                    <div class="layui-row">
                        <div class="layui-col-sm8">
                            <div class="layui-carousel layadmin-carousel layadmin-dataview" data-anim="fade"
                                 lay-filter="LAY-index-pagetwo">
                                <div carousel-item id="LAY-index-pagetwo">
                                    <div><i class="layui-icon layui-icon-loading1 layadmin-loading"></i></div>
                                </div>
                            </div>
                        </div>
                        <div class="layui-col-sm4">
                            <div class="layuiadmin-card-list">
                                <p class="layuiadmin-normal-font">月访问数</p>
                                <span>同上期增长</span>
                                <div class="layui-progress layui-progress-big" lay-showPercent="yes">
                                    <div class="layui-progress-bar" lay-percent="30%"></div>
                                </div>
                            </div>
                            <div class="layuiadmin-card-list">
                                <p class="layuiadmin-normal-font">月问卷新增数</p>
                                <span>同上期增长</span>
                                <div class="layui-progress layui-progress-big" lay-showPercent="yes">
                                    <div class="layui-progress-bar" lay-percent="20%"></div>
                                </div>
                            </div>
                            <div class="layuiadmin-card-list">
                                <p class="layuiadmin-normal-font">月问卷填写人次</p>
                                <span>同上期增长</span>
                                <div class="layui-progress layui-progress-big" lay-showPercent="yes">
                                    <div class="layui-progress-bar" lay-percent="25%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="layui-col-sm12">
            <div class="layui-card">
                <div class="layui-card-header">
                    近七天问卷填写人次
                    <div class="layui-btn-group layuiadmin-btn-group">
                        <a href="javascript:;" class="layui-btn layui-btn-primary layui-btn-xs">本周</a>
                    </div>
                </div>
                <div class="layui-card-body">
                    <div class="layui-carousel layadmin-carousel layadmin-dataview" data-anim="fade" lay-filter="LAY-index-heapline">
                        <div carousel-item id="LAY-index-heapbar">
                            <div><i class="layui-icon layui-icon-loading1 layadmin-loading"></i></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
</div>

<script src="../../../static/js/jquery-2.1.0.js"></script>
<script src="../../static/layuiadmin/layui/layui.js"></script>
<script src="../../static/js/util/request.js"></script>
<script src="../../static/js/util/timeAndNumFormat.js"></script>
<script>

    // 查询总访问次数的 url
    var visitCountUrl = "/index/visit_count";
    // 查询用户量的 url
    var userCountUrl = "/index/user_count";
    // 活跃用户的 url
    var activeUserCountUrl = '/index/active_user_count';
    // 问卷量
    var questionnaireCountUrl = '/index/questionnaire_count';

    layui.config({
        base: '../../static/layuiadmin/' //静态资源所在路径
    }).extend({
        //主入口模块
        index: 'lib/index'
    }).use(['index', 'console'], function () {

        // 访问量
        reqNum = 6;
        var month = getPreMonth(0);
        var year = month['year'];
        var month = month['month'] > 9 ? month['month'] : '0'+month['month'];
        var day = '01';
        var startTime = year+'-'+month+'-'+day;
        requestAsync(visitCountUrl, JSON.stringify({'startTime': startTime}), function (data) {
            $('#visit_month').html(formatNum(data.data));
        });
        requestAsync(visitCountUrl, JSON.stringify({}), function (data) {
            $('#visit_all').html(parseNum(data.data));
        });
        requestAsync(userCountUrl, JSON.stringify({'startTime': startTime}), function (data) {
            $('#usercount_month').html(formatNum(data.data));
        });
        requestAsync(userCountUrl, JSON.stringify({}), function (data) {
            $('#usercount_all').html(parseNum(data.data));
            requestAsync(activeUserCountUrl, JSON.stringify({'startTime': startTime}), function (d) {
                $('#useractive_month').html(formatNum(d.data));
                $('#useractive_month_percentage').html(getRatio(d.data, data.data)+'%');
            });
        });
        requestAsync(questionnaireCountUrl, JSON.stringify({'startTime': startTime}), function (data) {
            $('#questioncount_month').html(formatNum(data.data));
        });
        requestAsync(questionnaireCountUrl, JSON.stringify({}), function (data) {
            $('#question_count_all').html(formatNum(data.data));
        });

    });
</script>

</body>
</html>